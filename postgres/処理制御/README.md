## データベース接続通信の流れ

1. クライアントプロセスは最初にマスタサーバのポートに対してユーザ名と接続したいデータベース名を含むメッセージを送信する
2. マスタサーバはそのメッセージ内の情報と、pg_hba.conf の内容を比較して、接続が許容されてるか確認する
3. 該当する接続が認証を必要とする場合は、認証を要求するメッセージをクライアントに送信し、クライアントは認証に必要な情報をサーバに送信する(認証を必要としない場合、trust などはこの処理をスキップ)
4. サーバは認証情報を受け取ると、認証方式に従った処理を行う
5. 認証が成功すれば認証成功のメッセージをクライアントプロセスに返却し、バックエンドプロセスを fork()により生成する
6. マスタサーバはバックエンドプロセスの起動を行った後、クライアントプロセスに開始処理終了のメッセージを送信。クライアントプロセスは認証成功メッセージを受信した後、マスタサーバから開始処理終了のメッセージを受け取るまで待機。開始処理終了のメッセージを受信すると、接続が確立されたことになり、クライアントサーバからクエリを送信することが可能になる

- psql によるサーバへのアクセス時や、libpq/JDBC ライブラリを使用してサーバへアクセスする時はライブラリ内でこうしたメッセージ処理を行っている
